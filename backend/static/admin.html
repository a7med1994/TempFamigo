<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Famigo Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F9FAFB;
            color: #0C3B2E;
        }
        .header {
            background: #0C3B2E;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        .header p {
            color: #6D9773;
            font-size: 14px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .login-section {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 40px auto;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            color: #6B7280;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .stat-card .number {
            font-size: 32px;
            font-weight: 700;
            color: #6D9773;
        }
        .section {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section h2 {
            color: #0C3B2E;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn {
            background: #6D9773;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #5A7D5F;
        }
        .btn-danger {
            background: #EF4444;
        }
        .btn-danger:hover {
            background: #DC2626;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0C3B2E;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 16px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th {
            background: #F3F4F6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #E5E7EB;
        }
        .table td {
            padding: 12px;
            border-bottom: 1px solid #E5E7EB;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }
        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }
        .hidden {
            display: none;
        }
        .color-picker {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .color-picker input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŒ³ Famigo Admin Panel</h1>
        <p>Complete control over your family activity platform</p>
    </div>

    <div class="container">
        <!-- Login Section -->
        <div id="login-section" class="login-section">
            <h2 style="margin-bottom: 20px; color: #0C3B2E;">Admin Login</h2>
            <div class="input-group">
                <label>Admin Password</label>
                <input type="password" id="admin-password" placeholder="Enter admin password">
            </div>
            <button class="btn" onclick="login()">Access Admin Panel</button>
        </div>

        <!-- Dashboard (Hidden until login) -->
        <div id="dashboard" class="hidden">
            <!-- Stats -->
            <div class="stats-grid" id="stats-grid"></div>

            <!-- Theme Management -->
            <div class="section">
                <h2>ðŸŽ¨ Theme & Colors</h2>
                <div class="color-picker">
                    <div>
                        <label>Primary</label>
                        <input type="color" id="primary-color" value="#6D9773">
                    </div>
                    <div>
                        <label>Text</label>
                        <input type="color" id="text-color" value="#0C3B2E">
                    </div>
                    <div>
                        <label>Icon</label>
                        <input type="color" id="icon-color" value="#BB8A52">
                    </div>
                    <div>
                        <label>Accent</label>
                        <input type="color" id="accent-color" value="#FFBA00">
                    </div>
                </div>
                <button class="btn" onclick="updateTheme()">Update Theme Colors</button>
            </div>

            <!-- Content Management -->
            <div class="section">
                <h2>ðŸ“Š Content Management</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <button class="btn" onclick="loadContent('venues')">View Venues</button>
                    <button class="btn" onclick="loadContent('events')">View Events</button>
                    <button class="btn" onclick="loadContent('posts')">View Posts</button>
                </div>
            </div>

            <!-- Content Display -->
            <div class="section" id="content-section" style="display: none;">
                <h2 id="content-title">Content</h2>
                <div id="content-display"></div>
            </div>
        </div>
    </div>

    <script>
        let adminPassword = '';

        function login() {
            adminPassword = document.getElementById('admin-password').value;
            if (!adminPassword) {
                alert('Please enter admin password');
                return;
            }

            // Test password with stats endpoint
            fetch(`/api/admin/stats?password=${adminPassword}`)
                .then(res => {
                    if (res.status === 401) {
                        alert('Invalid password!');
                        return;
                    }
                    return res.json();
                })
                .then(data => {
                    if (data) {
                        document.getElementById('login-section').classList.add('hidden');
                        document.getElementById('dashboard').classList.remove('hidden');
                        loadStats();
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
        }

        function loadStats() {
            fetch(`/api/admin/stats?password=${adminPassword}`)
                .then(res => res.json())
                .then(data => {
                    const statsGrid = document.getElementById('stats-grid');
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <h3>Total Venues</h3>
                            <div class="number">${data.total_venues}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Events</h3>
                            <div class="number">${data.total_events}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Posts</h3>
                            <div class="number">${data.total_posts}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Bookings</h3>
                            <div class="number">${data.total_bookings}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Public Events</h3>
                            <div class="number">${data.public_events}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Private Events</h3>
                            <div class="number">${data.private_events}</div>
                        </div>
                    `;
                });
        }

        function updateTheme() {
            const theme = {
                primary_color: document.getElementById('primary-color').value,
                text_color: document.getElementById('text-color').value,
                icon_color: document.getElementById('icon-color').value,
                accent_color: document.getElementById('accent-color').value,
            };

            fetch(`/admin/theme?password=${adminPassword}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(theme)
            })
            .then(res => res.json())
            .then(data => {
                alert('Theme updated successfully!');
            })
            .catch(err => alert('Error: ' + err.message));
        }

        function loadContent(type) {
            fetch(`/admin/${type}/all?password=${adminPassword}`)
                .then(res => res.json())
                .then(data => {
                    const section = document.getElementById('content-section');
                    const title = document.getElementById('content-title');
                    const display = document.getElementById('content-display');
                    
                    section.style.display = 'block';
                    title.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    
                    let html = '<table class="table"><thead><tr>';
                    
                    if (type === 'venues') {
                        html += '<th>Name</th><th>Category</th><th>Rating</th><th>Actions</th>';
                    } else if (type === 'events') {
                        html += '<th>Title</th><th>Host</th><th>Date</th><th>Actions</th>';
                    } else if (type === 'posts') {
                        html += '<th>User</th><th>Type</th><th>Content</th><th>Actions</th>';
                    }
                    
                    html += '</tr></thead><tbody>';
                    
                    data.forEach(item => {
                        html += '<tr>';
                        if (type === 'venues') {
                            html += `<td>${item.name}</td><td>${item.category}</td><td>${item.rating}</td>`;
                        } else if (type === 'events') {
                            html += `<td>${item.title}</td><td>${item.host_name}</td><td>${new Date(item.date).toLocaleDateString()}</td>`;
                        } else if (type === 'posts') {
                            html += `<td>${item.user_name}</td><td>${item.post_type}</td><td>${item.content.substring(0, 50)}...</td>`;
                        }
                        html += `<td><button class="btn btn-danger" onclick="deleteItem('${type}', '${item.id}')">Delete</button></td>`;
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                    display.innerHTML = html;
                })
                .catch(err => alert('Error loading content: ' + err.message));
        }

        function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            fetch(`/admin/${type}/${id}?password=${adminPassword}`, {
                method: 'DELETE'
            })
            .then(res => res.json())
            .then(data => {
                alert('Item deleted successfully!');
                loadContent(type);
                loadStats();
            })
            .catch(err => alert('Error: ' + err.message));
        }
    </script>
</body>
</html>
